<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Interactive AR House</title>
    <!-- A-Frame core -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- AR.js for A-Frame -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <!-- Gesture detector for touch -->
    <script
        src="https://unpkg.com/aframe-gesture-detector-component@5.0.0/dist/aframe-gesture-detector.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        #status {
            position: absolute;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: #0f0;
            font-family: sans-serif;
            font-size: 1.2rem;
            padding: .5rem 1rem;
            border-radius: .25rem;
            display: none;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div id="status">Marker detected – loading house…</div>

    <a-scene embedded arjs="sourceType: webcam;" vr-mode-ui="enabled: false">

        <a-assets>
            <a-asset-item id="houseModel"
                src="https://crudblobs.blob.core.windows.net/models/front-gable-house.glb"></a-asset-item>
        </a-assets>

        <a-marker preset="hiro" emitevents="true" registerevents>
            <!--
          Add:
           - class="interactive" so cursor/raycaster hits it
           - gesture-handler for drag/scale/rotate
        -->
            <a-entity id="house" class="interactive" gltf-model="#houseModel" scale="0.1 0.1 0.1" rotation="0 180 0"
                gesture-detector gesture-handler>
            </a-entity>
        </a-marker>

        <!-- Camera + cursor for tap events -->
        <a-entity camera>
            <a-cursor rayOrigin="mouse" fuse="false" raycaster="objects: .interactive">
            </a-cursor>
        </a-entity>
    </a-scene>

    <script>
        // Show/hide the HUD
        AFRAME.registerComponent('registerevents', {
            init: function () {
                const status = document.getElementById('status');
                this.el.addEventListener('markerFound', () => status.style.display = 'block');
                this.el.addEventListener('markerLost', () => status.style.display = 'none');
            }
        });

        // Handle tap + gestures on the house
        AFRAME.registerComponent('gesture-handler', {
            init: function () {
                const el = this.el;
                let baseScale = el.getAttribute('scale');
                let dragging = false;

                // Tap: toggle color
                el.addEventListener('click', () => {
                    const mat = el.getObject3D('mesh').material;
                    mat.color.set(mat.color.getHex() === 0xffffff ? 0xffcc00 : 0xffffff);
                });

                // One-finger drag
                this.el.sceneEl.addEventListener('onefingermove', evt => {
                    if (!dragging && evt.detail.positionChange) dragging = true;
                    if (dragging) {
                        const pos = el.getAttribute('position');
                        el.setAttribute('position', {
                            x: pos.x + evt.detail.positionChange.x,
                            y: pos.y,
                            z: pos.z - evt.detail.positionChange.y
                        });
                    }
                });
                this.el.sceneEl.addEventListener('onefingerend', () => dragging = false);

                // Pinch to scale
                this.el.sceneEl.addEventListener('twofingermove', evt => {
                    const scaleFactor = baseScale.x * evt.detail.spreadChange;
                    el.setAttribute('scale', `${scaleFactor} ${scaleFactor} ${scaleFactor}`);
                });
                this.el.sceneEl.addEventListener('twofingerend', () => {
                    baseScale = el.getAttribute('scale');
                });

                // Two-finger rotate (around Y axis)
                this.el.sceneEl.addEventListener('twofingerrotate', evt => {
                    const rot = el.getAttribute('rotation');
                    el.setAttribute('rotation', {
                        x: rot.x,
                        y: rot.y + evt.detail.rotationChange,
                        z: rot.z
                    });
                });
            }
        });
    </script>
</body>

</html>