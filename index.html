<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Markerless AR + House Model</title>
    <!-- A-Frame core -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- Hand-tracking controls -->
    <script src="https://unpkg.com/aframe-hand-tracking-component/dist/aframe-hand-tracking-component.min.js"></script>
    <!-- Super-hands for grab events -->
    <script src="https://unpkg.com/aframe-super-hands-component@^4.0.0/dist/aframe-super-hands.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <a-scene embedded renderer="colorManagement: true; physicallyCorrectLights: true"
        webxr="optionalFeatures: hit-test, hand-tracking; referenceSpaceType: local-floor" ar-mode-ui="enabled: true">
        <!-- Preload the house model from a public CDN -->
        <a-assets>
            <a-asset-item id="houseModel" src="https://crudblobs.blob.core.windows.net/models/house.glb">
            </a-asset-item>
        </a-assets>

        <!-- Reticle for hit-test placement -->
        <a-entity id="reticle" geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.06" material="shader: flat"
            visible="false">
        </a-entity>

        <!-- House youâ€™ll pinch & move -->
        <a-entity id="house" class="grabbable" gltf-model="#houseModel" scale="0.3 0.3 0.3" visible="false" grabbable
            stretchable>
        </a-entity>

        <!-- Hand-tracking input -->
        <a-entity hand-tracking-controls="hand: left"></a-entity>
        <a-entity hand-tracking-controls="hand: right"></a-entity>

        <!-- AR camera -->
        <a-entity camera look-controls="enabled: false"></a-entity>
    </a-scene>

    <script>
        const sceneEl = document.querySelector('a-scene');
        const reticle = document.getElementById('reticle');
        const house = document.getElementById('house');

        // When entering AR, set up hit-test loop
        sceneEl.addEventListener('enter-vr', async () => {
            const session = sceneEl.renderer.xr.getSession();
            if (!session || session.environmentBlendMode !== 'alpha-blend') return;

            const refSpace = await session.requestReferenceSpace('local-floor');
            const viewerSpace = await session.requestReferenceSpace('viewer');
            const hitTestSource = await session.requestHitTestSource({ space: viewerSpace });

            sceneEl.renderer.setAnimationLoop((time, frame) => {
                const hits = frame.getHitTestResults(hitTestSource);
                if (hits.length) {
                    const hit = hits[0].getPose(refSpace);
                    reticle.object3D.position.copy(hit.transform.position);
                    reticle.object3D.quaternion.copy(hit.transform.orientation);
                    reticle.visible = true;
                }
            });
        });

        // On tap/place, attach house to the reticle
        document.body.addEventListener('click', () => {
            if (reticle.visible) {
                house.object3D.position.copy(reticle.object3D.position);
                house.object3D.quaternion.copy(reticle.object3D.quaternion);
                house.setAttribute('visible', true);
            }
        });
    </script>
</body>

</html>